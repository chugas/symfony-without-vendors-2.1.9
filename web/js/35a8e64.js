(function(c,d,b){var a={post:function(g,i,k,f,e){var j=function(l){if("undefined"!==typeof f){f(l.responseText,l.status)}};var h=function(l){if("undefined"!==typeof e){e(l.responseText,l.status)}};d.post(g,i,k).error(j).complete(h)},get:function(f,g,i,e){var h=function(j){if("undefined"!==typeof e){e(j.responseText,j.status)}};d.get(f,g,i).error(h)},getThreadComments:function(e,g){var f=jQuery.Event("fos_comment_before_load_thread");f.identifier=e;f.params={permalink:encodeURIComponent(g||c.location.href)};a.thread_container.trigger(f);a.get(a.base_url+"/"+encodeURIComponent(f.identifier)+"/comments",f.params,function(h){a.thread_container.html(h);a.thread_container.attr("data-thread",f.identifier);a.thread_container.trigger("fos_comment_load_thread",f.identifier)})},initializeListeners:function(){a.thread_container.on("submit","form.fos_comment_comment_new_form",function(i){var h=d(this);var f=a.serializeObject(this);i.preventDefault();var g=d.Event("fos_comment_submitting_form");h.trigger(g);if(g.isDefaultPrevented()){return}a.post(this.action,f,function(j,e){a.appendComment(j,h);h.trigger("fos_comment_new_comment",j)},function(k,j){var e=h.parent();e.after(k);e.remove()},function(j,e){h.trigger("fos_comment_submitted_form",e)})});a.thread_container.on("click",".fos_comment_comment_reply_show_form",function(g){var h=d(this).data();var f=d(this);if(f.closest(".fos_comment_comment_reply").hasClass("fos_comment_replying")){return f}a.get(h.url,{parentId:h.parentId},function(e){f.closest(".fos_comment_comment_reply").addClass("fos_comment_replying");f.after(e);f.trigger("fos_comment_show_form",e)})});a.thread_container.on("click",".fos_comment_comment_reply_cancel",function(h){var f=d(this).closest(".fos_comment_comment_form_holder");var g=d.Event("fos_comment_cancel_form");f.trigger(g);if(g.isDefaultPrevented()){return}f.closest(".fos_comment_comment_reply").removeClass("fos_comment_replying");f.remove()});a.thread_container.on("click",".fos_comment_comment_edit_show_form",function(g){var h=d(this).data();var f=d(this);a.get(h.url,{},function(e){var i=d(h.container);i.data("original",i.html());i.html(e);f.trigger("fos_comment_show_edit_form",e)})});a.thread_container.on("submit","form.fos_comment_comment_edit_form",function(g){var f=d(this);a.post(this.action,a.serializeObject(this),function(e){a.editComment(e);f.trigger("fos_comment_edit_comment",e)},function(i,h){var e=f.parent();e.after(i);e.remove()});g.preventDefault()});a.thread_container.on("click",".fos_comment_comment_edit_cancel",function(f){a.cancelEditComment(d(this).parents(".fos_comment_comment_body"))});a.thread_container.on("click",".fos_comment_comment_vote",function(g){var f=d(this);var h=f.data();a.get(h.url,{},function(i){var e=d(d.trim(i)).children("form")[0];var j=d(e).data();a.post(e.action,a.serializeObject(e),function(k){d("#"+j.scoreHolder).html(k);f.trigger("fos_comment_vote_comment",k,e)})})});a.thread_container.on("click",".fos_comment_comment_remove",function(g){var h=d(this).data();var f=d.Event("fos_comment_removing_comment");d(this).trigger(f);if(f.isDefaultPrevented()){return}a.get(h.url,{},function(i){var e=d(d.trim(i)).children("form")[0];a.post(e.action,a.serializeObject(e),function(l){var j=d(d.trim(l));var k=d("#"+j.attr("id"));k.replaceWith(j)})})});a.thread_container.on("click",".fos_comment_thread_commentable_action",function(f){var g=d(this).data();a.get(g.url,{},function(h){var e=d(d.trim(h)).children("form")[0];a.post(e.action,a.serializeObject(e),function(j){var i=d(d.trim(j)).children("form")[0];var k=d(i).data().fosCommentThreadId;a.getThreadComments(k)})})})},appendComment:function(g,h){var j=h.data();if(""!=j.parent){var f=h.closest(".fos_comment_comment_form_holder");var i=h.closest(".fos_comment_comment_reply");var e=h.closest(".fos_comment_comment_show").children(".fos_comment_comment_replies");i.removeClass("fos_comment_replying");e.prepend(g);e.trigger("fos_comment_add_comment",g);f.remove()}else{h.after(g);h.trigger("fos_comment_add_comment",g);h=d(h[0]);h[0].reset();h.children(".fos_comment_form_errors").remove()}},editComment:function(e){var e=d(d.trim(e));var f=d("#"+e.attr("id")).children(".fos_comment_comment_body");f.html(e.children(".fos_comment_comment_body").html())},cancelEditComment:function(e){e.html(e.data("original"))},serializeObject:function(f){var g={};var e=d(f).serializeArray();d.each(e,function(){if(g[this.name]!==undefined){if(!g[this.name].push){g[this.name]=[g[this.name]]}g[this.name].push(this.value||"")}else{g[this.name]=this.value||""}});return g},loadCommentCounts:function(){var e=[];var f=d("span.fos-comment-count");f.each(function(g,h){var j=d(h).data("fosCommentThreadId");if(j){e.push(j)}});a.get(a.base_url+".json",{ids:e},function(j){if(typeof j!="object"){j=jQuery.parseJSON(j)}var h={};for(var g in j.threads){h[j.threads[g].id]=j.threads[g]}d.each(f,function(){var i=d(this).data("fosCommentThreadId");if(i){a.setCommentCount(this,h[i])}})})},setCommentCount:function(f,e){if(e==undefined){f.innerHTML="0";return}f.innerHTML=e.num_comments}};a.thread_container=c.fos_comment_thread_container||d("#fos_comment_thread");if(typeof c.fos_comment_remote_cors_url!="undefined"){a.easyXDM=b.noConflict("FOS_COMMENT");a.request=function(k,f,h,j,e){var g=function(l){if("undefined"!==typeof j){j(l.data,l.status)}};var i=function(l){if("undefined"!==typeof e){e(l.data.data,l.data.status)}};a.xhr.request({url:f,method:k,data:h},g,i)};a.post=function(f,g,h,e){this.request("POST",f,g,h,e)};a.get=function(f,g,i,e){var h=jQuery.param(g);f+=""!=h?"?"+h:"";this.request("GET",f,undefined,i,e)};a.xhr=new a.easyXDM.Rpc({remote:c.fos_comment_remote_cors_url},{remote:{request:{}}})}a.base_url=c.fos_comment_thread_api_base_url;if(typeof c.fos_comment_thread_id!="undefined"){a.getThreadComments(c.fos_comment_thread_id)}if(typeof c.fos_comment_thread_comment_count_callback!="undefined"){a.setCommentCount=c.fos_comment_thread_comment_count_callback}if(d("span.fos-comment-count").length>0){a.loadCommentCounts()}a.initializeListeners();c.fos=c.fos||{};c.fos.Comment=a})(window,window.jQuery,window.easyXDM);