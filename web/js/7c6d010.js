(function(b){function a(c,d){var c=b.extend({search_input_el:null,search_action_el:null,search_error_el:null,current_position_el:null,default_lat:"1",default_lng:"-1",default_zoom:5,lat_field:null,lng_field:null,callback:function(e,f){},error_callback:function(e){$this.settings.search_error_el.text(e)},},c);this.settings=c;this.map_el=d;this.geocoder=new google.maps.Geocoder()}a.prototype={initMap:function(c){var c=new google.maps.LatLng(this.settings.default_lat,this.settings.default_lng);var d={zoom:this.settings.default_zoom,center:c,mapTypeId:google.maps.MapTypeId.ROADMAP};var e=this;this.map=new google.maps.Map(this.map_el[0],d);this.addMarker(c);google.maps.event.addListener(this.marker,"dragend",function(g){var f=e.marker.getPosition();e.map.panTo(f);e.updateLocation(f)});google.maps.event.addListener(this.map,"click",function(f){e.insertMarker(f.latLng)});this.settings.search_action_el.click(b.proxy(this.searchAddress,e));this.settings.current_position_el.click(b.proxy(this.currentPosition,e))},searchAddress:function(f){f.preventDefault();var d=this;var c=this.settings.search_input_el.val();this.geocoder.geocode({address:c},function(g,e){if(e==google.maps.GeocoderStatus.OK){d.map.setCenter(g[0].geometry.location);d.map.setZoom(16);d.insertMarker(g[0].geometry.location)}else{d.settings.error_callback(e)}})},currentPosition:function(d){d.preventDefault();var c=this;if(navigator.geolocation){navigator.geolocation.getCurrentPosition(function(e){var f=new google.maps.LatLng(e.coords.latitude,e.coords.longitude);c.insertMarker(f);c.map.setCenter(f);c.map.setZoom(16)},function(e){c.settings.error_callback(e)})}else{c.settings.search_error_el.text("Your broswer does not support geolocation")}},updateLocation:function(c){this.settings.lat_field.val(c.lat());this.settings.lng_field.val(c.lng());this.settings.callback(c,this)},addMarker:function(c){if(this.marker){this.marker.setMap(this.map);this.marker.setPosition(c)}else{this.marker=new google.maps.Marker({map:this.map,position:c,draggable:true})}},insertMarker:function(c){this.removeMarker();this.addMarker(c);this.updateLocation(c)},removeMarker:function(){if(this.marker!=undefined){this.marker.setMap(null)}}};b.fn.ohGoogleMapType=function(c){c=b.extend({},b.fn.ohGoogleMapType.defaultSettings,c||{});return this.each(function(){var d=b(this);d.data("map",new a(c,d));d.data("map").initMap()})};b.fn.ohGoogleMapType.defaultSettings={search_input_el:null,search_action_el:null,search_error_el:null,current_position_el:null,default_lat:"1",default_lng:"-1",default_zoom:5,lat_field:null,lng_field:null,callback:function(c,d){},error_callback:function(c){$this.settings.search_error_el.text(c)}}})(jQuery);